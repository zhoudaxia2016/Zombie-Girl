<html>
  <head>
    <meta charset="utf-8">
    <title>Threejs and Blender Game Design</title>
    <style>
      * { margin: 0 }
      canvas { width: 100%; height: 100% }
    </style>
    <script src="https://cdn.bootcss.com/three.js/90/three.min.js"></script>
    <script src="lib/collada-loader.js"></script>
    <script src="utils.js"></script>
    <script src="object.js"></script>
  </head>

  <body>
    <script>
let scene, renderer, camera, container
let clock = new THREE.Clock(true)

init()

// 导入role
let role = new Person('./model/boy.json')
let roleLoadPromise = role.load()


// 导入land和surrounddings
let surrounddings = [], land = {}
let surrounddingLoadPromise = Surroundding.load('./model/land.json')

let loadPromise = Promise.all([roleLoadPromise, surrounddingLoadPromise])
loadPromise.then(function () {
  role.setCamera(camera)
  animate()
})

function init () {
  container = document.createElement('div')
  document.body.appendChild(container)

  // scene
  scene = new THREE.Scene()

  // camera
  camera = new THREE.PerspectiveCamera( 40, window.innerWidth / window.innerHeight, 1, 1000 );

  // light
  scene.add( new THREE.AmbientLight( 0xffffff ) );
  directionalLight = new THREE.DirectionalLight( 0xffffff, 0.5 );
  directionalLight.position.set( 0, 100, 0 );
  directionalLight.castShadow = true
  scene.add( directionalLight );

  // renderer
  renderer = new THREE.WebGLRenderer()
  renderer.shadowMapEnabled = true;
  renderer.setPixelRatio( window.devicePixelRatio );
  renderer.setSize( window.innerWidth, window.innerHeight );
  renderer.setClearColor( 0xaaaaaa )

  container.appendChild( renderer.domElement );
}

function animate () {
  requestAnimationFrame(animate);
  role.move()
  role.groundHitDetect(land)

  if (!fall.done) {
    fall.done = true
    fall()
  }
  render();
}

function render() {
  renderer.render( scene, camera );
}
    </script>
  </body>
</html>
